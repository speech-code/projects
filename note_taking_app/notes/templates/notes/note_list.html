{% extends 'base.html' %}
{% block content %}
<h2>Notes</h2>
<form method="get" action=".">
    <input type="text" name="q" placeholder="Search notes..." value="{{ request.GET.q }}">
    <select name="tag" onchange="this.form.submit()">
        <option value="">All Tags</option>
        {% for tag in tags %}
            <option value="{{ tag.name }}" {% if request.GET.tag == tag.name %}selected{% endif %}>{{ tag.name }}</option>
        {% endfor %}
    </select>
    <select name="category" onchange="this.form.submit()">
        <option value="">All Categories</option>
        {% for category in categories %}
            <option value="{{ category.name }}" {% if request.GET.category == category.name %}selected{% endif %}>{{ category.name }}</option>
        {% endfor %}
    </select>
    <button type="submit">Search/Filter</button>
</form>

<p><a href="{% url 'notes:note_create' %}">Create New Note</a></p>
<p><a href="{% url 'notes:tag_create' %}">Create New Tag</a></p>
<p><a href="{% url 'notes:category_create' %}">Create New Category</a></p>

<ul>
    {% for note in notes %}
        <li>
            <h3><a href="{% url 'notes:note_detail' note.pk %}">{{ note.title }}</a></h3>
            <p>{{ note.content|truncatechars:100 }}</p>
            <p>
                {% for tag in note.tags.all %}
                    <span class="tag">#{{ tag.name }}</span>
                {% endfor %}
                {% if note.category %}
                    <span class="category">Category: {{ note.category.name }}</span>
                {% endif %}
            </p>
            <p><small>Last updated: {{ note.updated_at|date:"M d, Y H:i" }}</small></p>
        </li>
    {% empty %}
        <li>No notes yet.</li>
    {% endfor %}
</ul>
{% endblock %}
